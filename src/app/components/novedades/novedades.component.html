<app-navbar></app-navbar>

<div class="container">
  <div class="row">
    <div class="col s12 m7 l7">
      <h1 class="title is-2">Lista de novedades</h1>
    </div>
    <div class="input-field col s12 m5 l5" style="margin-top: 35px;">
        <i class="material-icons prefix">search</i>
        <input id="icon_prefix" name="filtertext" type="text" [(ngModel)]="filtertext">
        <label for="icon_prefix">Busqueda</label>
    </div>
  </div>
<div class="row">
  <div class="col s8 m11 l11">
    <a class="waves-effect waves-light btn deep-orange lighten-1" style="margin-left: 5px;" [routerLink]="['/home']"><i class="material-icons left">arrow_back</i>Regresar</a>
  </div>
  <div class="col s4 m1 l1">
    <a class="btn-floating btn waves-effect waves-light modal-trigger green" href="#modal1"><i class="material-icons">add</i></a>
  </div>
</div>
<hr>

<div class="content">

<table class="responsive-table highlight">
    <thead>
      <tr>
        <th>Nº</th>
        <th>Titulo</th>
        <th>Fecha de publicación</th>
        <th>Descripción</th>
        <th>Link</th>
        <th>Imagen</th>
        <th>Operaciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let novedad of novedadService.novedades | filtertable:filtertext | paginate: {itemsPerPage: 10, currentPage: currentPage}; index as i">
        <th>{{i+1}}</th>
        <td>{{novedad.titulo}}</td>
        <td>{{novedad.fechaPublicacion}}</td>
        <td>{{novedad.descripcion}}</td>
        <td><a href="{{novedad.link}}" target="_blank">{{novedad.link}}</a></td>
        <td><img class="img-responsive" style="max-width: 100px; max-height: 100px; min-width: 100px; min-height: 100px;" src="{{novedad.imagen}}" alt=""></td>
        <td>
          <a class="btn-floating btn-small waves-effect waves-light modal-trigger yellow" (click)="updNovedadForm(novedad)"><i class="material-icons">mode_edit</i></a>
          <a class="btn-floating btn-small waves-effect waves-light red accent-4" (click)="deleteNovedad(novedad._id)"><i class="material-icons">delete</i></a>
        </td>
      </tr>
    </tbody>
  </table>

  <pagination-controls (pageChange)="paginaActual = $event" responsive="true" previousLabel="Anterior" nextLabel="Siguiente" screenReaderCurrentLabel = "Estás en la página"></pagination-controls>

</div>

</div>

<div id="modal1" class="modal modal-fixed-footer">
  <div class="modal-content">
    <h4>Nuevo</h4>
    <p>Crea una nueva novedad!</p>
    <hr>
    <div class="row">
      <form class="col s12" [formGroup]="postForm" (ngSubmit)='postNovedad()' novalidate>
        <div class="row">
          <div class="input-field col s12 m12 l12">
            <i class="material-icons prefix">title</i>
            <input id="titulo" type="text" class="validate" required minlength="6" maxlength="50" formControlName="titulo">
            <label for="titulo">Titulo</label>
            <div *ngIf="f.titulo.touched && !f.titulo.errors">
              <span class="helper-text" style="color: #4CAF50;">Bien</span>
            </div>
            <div *ngIf="f.titulo.touched && f.titulo.errors || submitted && f.titulo.errors">
              <div *ngIf="f.titulo.errors.required">
                <span class="helper-text" style="color: #d50000;">El titulo es requerido</span>
              </div>
              <div *ngIf="f.titulo.errors.minlength">
                <span class="helper-text" style="color: #d50000;">El titulo debe contener al menos 6 caracteres</span>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s12 m12 l12">
            <i class="material-icons prefix">insert_link</i>
            <input id="link" type="url" required pattern="http(s?)(:\/\/)((www.)?)(([^.]+)\.)?([a-zA-z0-9\-_]+)(.?)(\/[^\s]*)?" class="validate" formControlName="link">
            <label for="link">Url</label>
            <div *ngIf="f.link.touched && !f.link.errors">
              <span class="helper-text" style="color: #4CAF50;">Bien</span>
            </div>
            <div *ngIf="f.link.touched && f.link.errors || submitted && f.link.errors">
              <div *ngIf="f.link.errors.required">
                <span class="helper-text" style="color: #d50000;">El link es requerido</span>
              </div>
              <div *ngIf="f.link.errors.pattern">
                <span class="helper-text" style="color: #d50000;">No es una URL valida</span>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s12 m12 l12">
            <i class="material-icons prefix">description</i>
            <textarea id="descripcion" class="materialize-textarea" formControlName="descripcion"></textarea>
            <label>Descripción</label>
            <div *ngIf="f.descripcion.touched && f.descripcion.errors || submitted && f.descripcion.errors">
              <div *ngIf="f.descripcion.errors.required">
                <span class="helper-text" style="color: #d50000;">Debe ingresar una descripción</span>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s6 m12 l12">
            <div class="file-field input-field">
              <div class="btn-small">
                <span>Sube una imagen</span>
                <input type="file" accept="image/*" (change)="uploadFile($event, true)">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="Sube una imagen">
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <button class="btn waves-effect waves-light" [disabled]="!postForm.valid">Crear
            <i class="material-icons right">send</i>
          </button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal-footer">  
      <a class="modal-close waves-effect waves-red btn red" (click)="cerrarModal(true)"></a>
  </div>
</div>

<div id="modal2" class="modal modal-fixed-footer">
  <div class="modal-content">
    <h4>Nuevo</h4>
    <p>Crea un nuevo producto o servicio!</p>
    <hr>
    <div class="row">
      <form class="col s12" [formGroup]="putForm" (ngSubmit)='putNovedad()' novalidate>
        <div class="row">
          <input type="hidden" formControlName="_id" [(ngModel)]="novedadService.selectedNovedad._id">
          <div class="input-field col s12 m12 l12">
            <i class="material-icons prefix">title</i>
            <input id="titulo1" type="text" class="validate" required minlength="6" maxlength="50" formControlName="titulo" [(ngModel)]="novedadService.selectedNovedad.titulo">
            <label for="titulo1">Titulo</label>
            <div *ngIf="f.titulo.touched && !f.titulo.errors">
              <span class="helper-text" style="color: #4CAF50;">Bien</span>
            </div>
            <div *ngIf="f.titulo.touched && f.titulo.errors || submitted && f.titulo.errors">
              <div *ngIf="f.titulo.errors.required">
                <span class="helper-text" style="color: #d50000;">El titulo es requerido</span>
              </div>
              <div *ngIf="f.titulo.errors.minlength">
                <span class="helper-text" style="color: #d50000;">El titulo debe contener al menos 6 caracteres</span>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s12 m12 l12">
            <i class="material-icons prefix">insert_link</i>
            <input id="link1" type="url" required pattern="http(s?)(:\/\/)((www.)?)(([^.]+)\.)?([a-zA-z0-9\-_]+)(.?)(\/[^\s]*)?" class="validate" formControlName="link" [(ngModel)]="novedadService.selectedNovedad.link">
            <label for="link1">Url</label>
            <div *ngIf="f.link.touched && !f.link.errors">
              <span class="helper-text" style="color: #4CAF50;">Bien</span>
            </div>
            <div *ngIf="f.link.touched && f.link.errors || submitted && f.link.errors">
              <div *ngIf="f.link.errors.required">
                <span class="helper-text" style="color: #d50000;">El link es requerido</span>
              </div>
              <div *ngIf="f.link.errors.pattern">
                <span class="helper-text" style="color: #d50000;">No es una URL valida</span>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s12 m12 l12">
            <i class="material-icons prefix">description</i>
            <textarea id="descripcion1" class="materialize-textarea" formControlName="descripcion" [(ngModel)]="novedadService.selectedNovedad.descripcion"></textarea>
            <label>Descripción</label>
            <div *ngIf="f.descripcion.touched && f.descripcion.errors || submitted && f.descripcion.errors">
              <div *ngIf="f.descripcion.errors.required">
                <span class="helper-text" style="color: #d50000;">Debe ingresar una descripción</span>
              </div>
            </div>
          </div>
          <input type="hidden" formControlName="image" [(ngModel)]="novedadService.selectedNovedad.imagen">
        </div>
        <div class="row">
          <div class="input-field col s6 m12 l12">
            <div class="file-field input-field">
              <div class="btn-small">
                <span>Sube una imagen</span>
                <input type="file" accept="image/*" (change)="uploadFile($event, false)">
              </div>
              <div class="file-path-wrapper">
                <input class="file-path validate" type="text" placeholder="Sube una imagen">
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <button class="btn waves-effect waves-light" [disabled]="!putForm.valid">Actualizar
            <i class="material-icons right">send</i>
          </button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal-footer">  
      <a class="modal-close waves-effect waves-red btn red" (click)="cerrarModal(false)"></a>
  </div>
</div>